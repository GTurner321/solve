<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equation Solver Game</title>
    <style>
        body {
            background-color: lightgreen;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }

        .equation {
            font-size: 24px;
            margin: 10px 0;
        }

        .user-input {
            margin: 10px 0;
        }

        .message {
            color: orange;
            font-size: 18px;
            margin: 10px 0;
        }

        .success {
            color: green;
            font-size: 24px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>Equation Solver Game</h1>
    <div id="equations-container"></div>
    <script>
        // Utility functions
        function randomNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function formatEquation(a, b, c, d) {
            let left = `${a === 1 ? "" : a === -1 ? "-" : a}x${b >= 0 ? "+" : ""}${b}`;
            let right = `${c === 1 ? "" : c === -1 ? "-" : c}x${d >= 0 ? "+" : ""}${d}`;
            return `${left}=${right}`.replace("+-", "-");
        }

        function applyOperation(input, a, b, c, d) {
            let op = input[0];
            let rest = input.slice(1);
            let num = parseFloat(rest.replace("x", ""));
            let hasX = rest.includes("x");

            if (isNaN(num)) {
                return { message: "Try again", error: true };
            }

            switch (op) {
                case "+":
                case "-":
                    if (!hasX) {
                        b = eval(`${b}${op}${num}`);
                        d = eval(`${d}${op}${num}`);
                    } else {
                        a = eval(`${a}${op}${num}`);
                        c = eval(`${c}${op}${num}`);
                    }
                    break;
                case "x":
                case "*":
                case "/":
                    if (hasX) {
                        return { message: "This is not supported, try again", error: true };
                    } else {
                        a = eval(`${a}${op}${num}`);
                        b = eval(`${b}${op}${num}`);
                        c = eval(`${c}${op}${num}`);
                        d = eval(`${d}${op}${num}`);
                    }
                    break;
                default:
                    return { message: "Try again", error: true };
            }

            return { a, b, c, d, error: false };
        }

        function checkEndState(a, b, c, d) {
            if (a === 1 && b === 0 && c === 0) return `x=${d}`;
            if (a === 0 && c === 1 && d === 0) return `x=${b}`;
            return null;
        }

        // Initialization
        let a, b, c, d;
        do {
            a = randomNumber(1, 10) * (Math.random() < 0.5 ? -1 : 1);
            b = randomNumber(1, 10) * (Math.random() < 0.5 ? -1 : 1);
            c = randomNumber(1, 10) * (Math.random() < 0.5 ? -1 : 1);
            d = randomNumber(1, 10) * (Math.random() < 0.5 ? -1 : 1);
        } while (a === c);

        let equationsContainer = document.getElementById("equations-container");
        let equationIndex = 0;

        function addEquationLine(equation, isError = false, message = "") {
            const div = document.createElement("div");
            div.className = "equation";
            div.innerHTML = `${equation}`;

            const inputBox = document.createElement("input");
            inputBox.type = "text";
            inputBox.className = "user-input";
            inputBox.placeholder = "Enter operation...";
            inputBox.disabled = isError;
            inputBox.addEventListener("keydown", function (e) {
                if (e.key === "Enter") {
                    const result = applyOperation(inputBox.value, a, b, c, d);

                    if (result.error) {
                        addEquationLine(equation, true, result.message);
                    } else {
                        a = result.a;
                        b = result.b;
                        c = result.c;
                        d = result.d;

                        const endState = checkEndState(a, b, c, d);
                        if (endState) {
                            addEquationLine(endState);
                            const successMessage = document.createElement("div");
                            successMessage.className = "success";
                            successMessage.innerHTML = "Congratulations! You have solved the equation!";
                            equationsContainer.appendChild(successMessage);
                        } else {
                            addEquationLine(formatEquation(a, b, c, d));
                        }
                    }

                    inputBox.disabled = true;
                }
            });

            if (!isError) div.appendChild(inputBox);
            if (message) {
                const msgDiv = document.createElement("div");
                msgDiv.className = "message";
                msgDiv.innerText = message;
                div.appendChild(msgDiv);
            }

            equationsContainer.appendChild(div);
        }

        addEquationLine(formatEquation(a, b, c, d));
    </script>
</body>
</html>
