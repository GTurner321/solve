<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Equation Solver</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      padding: 0;
      background-color: #e6ffe6;
    }
    .equation {
      margin: 10px 0;
      text-align: center;
      font-size: 1.5rem;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .input-row {
      display: inline-flex;
      align-items: center;
      margin-left: 10px;
    }
    input[type="text"] {
      padding: 5px;
      font-size: 1rem;
    }
    .message {
      color: red;
      font-weight: bold;
      text-align: center;
    }
    .congratulations {
      color: green;
      font-weight: bold;
      text-align: center;
      font-size: 1.5rem;
    }
  </style>
</head>
<body>
  <h1 style="text-align: center;">Equation Solver</h1>
  <div id="equation-container"></div>
  <div id="message" class="message"></div>

  <script>
    // Utility functions
    const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

    const gcd = (a, b) => (b === 0 ? a : gcd(b, a % b));

    const toFraction = (decimal) => {
      let denominator = 1;
      while (Math.abs(decimal * denominator - Math.round(decimal * denominator)) > 1e-10) {
        denominator *= 10;
      }
      const numerator = Math.round(decimal * denominator);
      const divisor = gcd(numerator, denominator);
      return `${numerator / divisor}/${denominator / divisor}`;
    };

    const formatEquation = (a, b, c, d) => {
      const formatTerm = (coef, variable) => {
        if (coef === 0) return '';
        if (coef === 1) return variable;
        if (coef === -1) return `- ${variable}`;
        return `${coef > 0 ? '' : '- '}${Math.abs(coef)}${variable}`;
      };

      const left = [formatTerm(a, 'x'), b !== 0 ? `${b > 0 ? '+ ' : '- '}${Math.abs(b)}` : ''].filter(Boolean).join(' ');
      const right = [formatTerm(c, 'x'), d !== 0 ? `${d > 0 ? '+ ' : '- '}${Math.abs(d)}` : ''].filter(Boolean).join(' ');

      return `${left} = ${right}`;
    };

    const parseInput = (input) => {
      const standardizedInput = input.replace('/', 'รท').replace(/^\+x$/, '+1x').replace(/^-x$/, '-1x');
      const match = standardizedInput.match(/^([+\-x\u00F7])(\d+|1)(x?)$/) || standardizedInput.match(/^([x\u00F7])(-\d+)(x?)$/);
      if (!match) return null;
      const [, operator, value, isVariable] = match;
      return { operator, value: parseFloat(value), isVariable: isVariable === 'x' };
    };

    // Game state
    let a, b, c, d;

    const resetEquation = () => {
      a = randomInt(1, 10);
      b = randomInt(1, 10);
      c = randomInt(1, 10);
      d = randomInt(1, 10);
      updateEquation();
    };

    const updateEquation = (operation = '', previousInput = '') => {
      const equationContainer = document.getElementById('equation-container');
      const message = document.getElementById('message');

      message.textContent = '';

      const equationDiv = document.createElement('div');
      equationDiv.classList.add('equation');
      equationDiv.innerHTML = `${formatEquation(a, b, c, d)}`;
      if (previousInput) {
        const userInput = document.createElement('span');
        userInput.textContent = ` (${previousInput})`;
        userInput.style.marginLeft = '10px';
        equationDiv.appendChild(userInput);
      }

      const inputRow = document.createElement('div');
      inputRow.classList.add('input-row');

      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'Enter operation (e.g., +2, -3x)';
      inputRow.appendChild(input);

      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          handleInput(input.value);
          inputRow.removeChild(input);
        }
      });

      equationDiv.appendChild(inputRow);
      equationContainer.appendChild(equationDiv);
    };

    const handleInput = (input) => {
      const parsed = parseInput(input);
      const message = document.getElementById('message');

      if (!parsed) {
        message.textContent = 'Try again';
        return;
      }

      const { operator, value, isVariable } = parsed;
      message.textContent = '';

      if (isVariable) {
        if (operator === 'x' || operator === '\u00F7') {
          message.textContent = 'This is not supported, try again';
          return;
        }
        if (operator === '+') {
          a += value;
          c += value;
        } else if (operator === '-') {
          a -= value;
          c -= value;
        }
      } else {
        if (operator === '+') {
          b += value;
          d += value;
        } else if (operator === '-') {
          b -= value;
          d -= value;
        } else if (operator === 'x') {
          a *= value;
          b *= value;
          c *= value;
          d *= value;
        } else if (operator === '\u00F7') {
          a /= value;
          b /= value;
          c /= value;
          d /= value;
        }
      }

      if (a === 1 && b === 0 && c === 0) {
        const equationContainer = document.getElementById('equation-container');
        const equationDiv = document.createElement('div');
        equationDiv.classList.add('equation');
        equationDiv.textContent = `x = ${d}`;
        equationContainer.appendChild(equationDiv);

        const congratsDiv = document.createElement('div');
        congratsDiv.classList.add('congratulations');
        congratsDiv.textContent = 'Congratulations! You have solved the equation. Refresh the page for a new equation.';
        equationContainer.appendChild(congratsDiv);
      } else {
        updateEquation(input);
      }
    };

    resetEquation();
  </script>
</body>
</html>
