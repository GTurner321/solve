<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equation Solver Game</title>
    <style>
        body {
            background-color: lightgreen;
            font-family: Arial, sans-serif;
            text-align: center;
        }

        .equation {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .input-box {
            margin-left: 50px;
        }

        .message {
            color: orange;
            font-size: 20px;
        }

        .success {
            color: green;
            font-size: 24px;
        }

        input[type="text"] {
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div id="game"></div>

    <script>
        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function formatNumber(num) {
            return parseFloat(num.toFixed(3));
        }

        function generateEquation() {
            let a, c;
            do {
                a = randomInt(1, 10);
                c = randomInt(1, 10);
            } while (a === c);
            const b = randomInt(1, 10);
            const d = randomInt(1, 10);
            return { a, b, c, d };
        }

        function formatEquation({ a, b, c, d }) {
            const formatted = `${a !== 1 ? a : ''}x${b >= 0 ? '+' : ''}${b} = ${c !== 1 ? c : ''}x${d >= 0 ? '+' : ''}${d}`;
            return formatted.replace(/\+\-/g, '-');
        }

        function evaluateOperation(equation, operation) {
            let { a, b, c, d } = equation;

            if (/^[+\-]?x$/.test(operation)) {
                operation = operation.replace('x', '1x');
            }

            if (/^[+\-]\d+x$/.test(operation)) {
                const value = parseFloat(operation.replace(/[+\-]/, ''));
                a += value;
                c += value;
            } else if (/^[+\-]\d+$/.test(operation)) {
                const value = parseFloat(operation);
                b += value;
                d += value;
            } else if (/^[x*]\d+$/.test(operation)) {
                const value = parseFloat(operation.replace(/x|\*/, ''));
                a *= value;
                b *= value;
                c *= value;
                d *= value;
            } else if (/^[\/รท]\d+$/.test(operation)) {
                const value = parseFloat(operation.replace(/[\/รท]/, ''));
                a /= value;
                b /= value;
                c /= value;
                d /= value;
            } else {
                return null;
            }

            return {
                a: formatNumber(a),
                b: formatNumber(b),
                c: formatNumber(c),
                d: formatNumber(d),
            };
        }

        function checkSolved(equation) {
            const { a, b, c, d } = equation;
            if (a === 1 && b === 0 && c === 0) {
                return `x=${d}`;
            } else if (a === 0 && c === 1 && d === 0) {
                return `${b}=x`;
            }
            return false;
        }

        function updateGame() {
            const inputBoxes = document.querySelectorAll('.input-box');
            inputBoxes.forEach(box => box.disabled = true);
            const currentEquation = equations[equations.length - 1];
            const userOperation = inputBoxes[inputBoxes.length - 1].value;
            const newEquation = evaluateOperation(currentEquation, userOperation);

            if (newEquation) {
                equations.push(newEquation);
                const solved = checkSolved(newEquation);
                if (solved) {
                    const success = document.createElement('div');
                    success.textContent = `Congratulations! You have solved the equation: ${solved}`;
                    success.className = 'success';
                    game.appendChild(success);
                    return;
                } else {
                    addEquationLine(newEquation);
                }
            } else {
                const message = document.createElement('div');
                message.textContent = 'Invalid input, try again';
                message.className = 'message';
                game.appendChild(message);
                const lastBox = inputBoxes[inputBoxes.length - 1];
                lastBox.disabled = false;
                lastBox.focus();
            }
        }

        function addEquationLine(equation) {
            const line = document.createElement('div');
            line.className = 'equation';
            line.textContent = formatEquation(equation);

            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'input-box';
            input.addEventListener('keydown', e => {
                if (e.key === 'Enter') {
                    updateGame();
                }
            });

            const container = document.createElement('div');
            container.appendChild(line);
            container.appendChild(input);
            game.appendChild(container);
            input.focus();
        }

        const equations = [];
        const game = document.getElementById('game');

        const initialEquation = generateEquation();
        equations.push(initialEquation);
        addEquationLine(initialEquation);
    </script>
</body>
</html>
